<div class="page-layout">
  <!-- Left Column: Input Section -->
  <div class="input-section">
    <p-card class="input-card">
      <div class="card-header">
        <div class="header-content">
          <div class="header-title-row">
            <h2>Metin Analizi</h2>
            <div class="header-actions">
              <p-button
                label="Analiz Et"
                icon="pi pi-bolt"
                styleClass="primary-action"
                [loading]="loading"
                [disabled]="!text.trim()"
                (onClick)="analyze()"
              ></p-button>
              <p-button
                label="Temizle"
                icon="pi pi-times"
                styleClass="secondary-action"
                [disabled]="!text.trim() || loading"
                (onClick)="clearText()"
              ></p-button>
              <p-button
                icon="pi pi-cog"
                [outlined]="true"
                [rounded]="true"
                severity="secondary"
                (onClick)="showOptionsDialog()"
                pTooltip="Analiz seçenekleri"
              ></p-button>
            </div>
          </div>
          <p class="meta">
            Türkçe metninizi girin ve {{ getAnalysisTypeLabel() }} hesaplayın
          </p>
        </div>
      </div>

      <div class="field">
        <label for="inputText" class="field-label">
          <i class="pi pi-align-left"></i>
          Metniniz
        </label>
        <textarea
          id="inputText"
          pTextarea
          [(ngModel)]="text"
          [autoResize]="true"
          rows="12"
          placeholder="Analiz edilecek Türkçe metni buraya yapıştırın..."
        ></textarea>
        <div class="field-footer">
          <span class="character-count" [class.has-text]="text.length > 0">
            <i class="pi pi-file-edit"></i>
            {{ text.length }} karakter
          </span>
        </div>
      </div>

      <div class="error" *ngIf="errorMessage">
        <i class="pi pi-exclamation-triangle"></i>
        {{ errorMessage }}
      </div>
    </p-card>
  </div>

  <!-- Right Column: Results Section -->
  <div class="results-section">
    <!-- Loading State -->
    <p-card *ngIf="loading" class="status-card">
      <div class="loading-state">
        <p-progressSpinner
          strokeWidth="3"
          styleClass="spinner"
        ></p-progressSpinner>
        <div class="loading-content">
          <h3>Analiz ediliyor...</h3>
          <p class="meta">Metin işlendiğinde sonuçlar otomatik görünecek</p>
        </div>
      </div>
    </p-card>

    <!-- Empty State -->
    <p-card *ngIf="!result && !loading" class="status-card empty-state">
      <div class="empty-content">
        <i class="pi pi-chart-bar empty-icon"></i>
        <h3>Sonuçlar burada görünecek</h3>
        <p class="meta">Metninizi girin ve analiz butonuna basın</p>
      </div>
    </p-card>

    <!-- Results -->
    <div *ngIf="result && !loading" class="results-container">
      <app-results-panel [statistics]="result?.statistics ?? null"></app-results-panel>

      <div class="export-section" *ngIf="result">
        <p-card class="export-card">
          <div class="export-content">
            <div class="export-header">
              <div>
                <h3>Sonuçları Kaydet</h3>
                <p class="meta">Analiz sonuçlarını dışa aktarın</p>
              </div>
              <i class="pi pi-download export-icon"></i>
            </div>
            <div class="export-actions">
              <p-select
                [options]="exportFormats"
                [(ngModel)]="exportFormat"
                optionLabel="label"
                optionValue="value"
                placeholder="Format seçin"
                styleClass="export-select"
              ></p-select>
              <p-button
                label="İndir"
                icon="pi pi-download"
                styleClass="secondary-action"
                [loading]="exporting"
                [disabled]="exporting"
                (onClick)="exportResult()"
              ></p-button>
            </div>
          </div>
        </p-card>
      </div>

      <app-sentence-list [sentences]="result.sentences"></app-sentence-list>
    </div>
  </div>
</div>

<!-- Analysis Options Dialog -->
<p-dialog
  header="Analiz Seçenekleri"
  [(visible)]="optionsDialogVisible"
  [modal]="true"
  [style]="{ width: '500px' }"
  [draggable]="false"
  [resizable]="false"
>
  <div class="options-dialog-content">
    <div class="option-section">
      <h3><i class="pi pi-chart-line"></i> Analiz Türü</h3>
      <p class="section-description">Metin okunabilirlik analizinde kullanılacak formülü seçin</p>

      <div class="analysis-types">
        <div
          class="analysis-type-card"
          [class.selected]="selectedAnalysisType === 'yod'"
          (click)="selectAnalysisType('yod')"
        >
          <div class="type-header">
            <i class="pi pi-check-circle check-icon"></i>
            <h4>YOD Değeri</h4>
          </div>
          <p class="type-description">Yeni Okunabilirlik Değeri - Modern Türkçe için geliştirilmiş formül</p>
          <div class="type-formula">YOD = a + b × (K/C) + c × (H/K)</div>
        </div>

        <div
          class="analysis-type-card"
          [class.selected]="selectedAnalysisType === 'atesman'"
          (click)="selectAnalysisType('atesman')"
        >
          <div class="type-header">
            <i class="pi pi-check-circle check-icon"></i>
            <h4>Ateşman Skoru</h4>
          </div>
          <p class="type-description">Flesch Reading Ease'in Türkçe uyarlaması</p>
          <div class="type-formula">A = 198.825 - 40.175 × (K/C) - 2.610 × (H/K)</div>
        </div>

        <div
          class="analysis-type-card"
          [class.selected]="selectedAnalysisType === 'cetinkaya'"
          (click)="selectAnalysisType('cetinkaya')"
        >
          <div class="type-header">
            <i class="pi pi-check-circle check-icon"></i>
            <h4>Çetinkaya-Uzun</h4>
          </div>
          <p class="type-description">Türkçe metinler için alternatif okunabilirlik formülü</p>
          <div class="type-formula">ÇU = 118.823 - 25.987 × (K/C) - 0.971 × (H/K)</div>
        </div>
      </div>
    </div>

    <div class="dialog-footer">
      <p-button
        label="İptal"
        icon="pi pi-times"
        [text]="true"
        (onClick)="optionsDialogVisible = false"
      ></p-button>
      <p-button
        label="Uygula"
        icon="pi pi-check"
        styleClass="primary-action"
        (onClick)="applyOptions()"
      ></p-button>
    </div>
  </div>
</p-dialog>
